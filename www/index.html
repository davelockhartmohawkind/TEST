
<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1">
		<title>Price Calculator</title>
		<!--<link rel="stylesheet" href="themes/MohawkPriceCalc2.min.css" />-->
        <link rel="stylesheet" href="themes/MohawkRed.min.css" />
		<!--<link rel="stylesheet" href="http://code.jquery.com/mobile/1.3.2/jquery.mobile.structure-1.3.2.min.css" />
		<script src="http://code.jquery.com/jquery-1.9.1.min.js"></script>
		<script src="http://code.jquery.com/mobile/1.3.2/jquery.mobile-1.3.2.min.js"></script>-->

        <link rel="stylesheet" href="css/jquery.mobile.structure-1.3.2.css" />
		<script src="js/jquery-1.9.1.min.js"></script>
		<script src="js/jquery.mobile-1.3.2.min.js"></script>
        <!-- <script src="js/format.20110630-1100.min.js"></script> --> <!--  formats numbers-->
        <script type="text/javascript" src="phonegap.js"></script>
        <script type="text/javascript" src="js/index.js"></script>
        <style>
            .ui-input-text
{ width: 85px; display: inline-block; }


        </style>
	</head>
	<body  class="no-touch">
        
		<div data-role="page" data-theme="a">
           
            <div data-role="header" data-position="fixed"   >
                <table> 
                    <tr>
                        <td><img  src="res/icon/ios/carpetcalc_icon_DRAFT.png"  width="48" height="48" /></td>
                        <td><a id="topMenuDealer" href="#panelDealer" data-role="button" data-icon="home"  data-theme="a" data-inline="true" data-mini="true" >Dealer</a>
                            <a id="topMenuWholesale"  href="#panelWholesale" data-role="button" data-icon="bars"  data-theme="a" data-inline="true" data-mini="true" >Wholesale</a>
                            <a id="topMenuRetail"  href="#panelRetail" data-role="button" data-icon="bars"  data-theme="a" data-inline="true" data-mini="true" >Retail</a>
                            <a id="topMenuSettings"  href="#panelSettings" data-role="button" data-icon="gear"  data-theme="a" data-inline="true" data-mini="true" >Settings</a>
                        </td>
                   </tr>
              </table>
           </div><!-- header-->
        
        <div  id="panelDealer" data-role="collapsible" data-collapsed="false" > <!--collapsible-->
         <h4>Dealer</h4>
			    <div data-role="content" data-theme="a"> <!--content-->
	             
                <!--    <a href="MustSelectDealer.html" data-rel="dialog" data-transition="flip">Detailed Instructions</a>-->
                      
                      <div  data-role="fieldcontain" >
                             <label for="selectDealerSelection">Dealer Option:</label>
                           <a href="#"  id="inputBtnAdd" data-role="button"  data-icon="add" data-iconpos="right" data-inline="true" data-theme="b" data-mini="true" >New</a>
                             <a href="#" id="inputBtnDelete"data-role="button" data-icon="delete" data-iconpos="right" data-inline="true" data-theme="b" hidden="hidden" data-mini="true"  >Delete</a>
                     
                          
                      </div> <!--fieldcontain-->
                       <div  data-role="fieldcontain" >
                            <label for="selectDealerSelection">Dealer Selection:</label>
                              <select id="selectDealerSelection" name="selectDealerSelection"  data-inline="true" data-mini="true" >
                                <!-- <option value=" ">CHOOSE</option> -->
                             </select>
                       </div> <!--fieldcontain-->
                   <div data-role="fieldcontain"  >
                      
                        <label >Dealer Name:</label>
                        <fieldset data-role="controlgroup"  data-type="horizontal" >
				        <legend>&nbsp;</legend>
                      
                           <input id="inputDealerSelection" type="text" placeholder="Dealer Name"    />
                        </fieldset>
                       
                    </div>

                    <div data-role="fieldcontain">
                        <label >Profit Type:</label>
                        <fieldset data-role="controlgroup"  data-type="horizontal" >
				            <legend>&nbsp;</legend>
				            <input type="radio" name="radioFormula" id="radioMarkup" value="Markup"   data-inline="true" data-mini="true" />
				            <label for="radioMarkup">Markup</label>
				            <input type="radio" name="radioFormula" id="radioProfitMargin" value="Margin"  data-inline="true" data-mini="true"  />
				            <label for="radioProfitMargin">Margin</label>
                        </fieldset> 
                     </div> <!--field contain-->

                    <div data-role="fieldcontain"   >
                         <label >Percent %:</label>
                         <fieldset data-role="controlgroup"  data-type="horizontal" >
                           <legend>&nbsp;</legend>
				           <input type="range" name="inputProfitMarginOrMarkup" id="inputProfitMarginOrMarkup" min="0" max="100" data-theme="a"  step="1" value="40" data-mini="true" />
                           </fieldset>
                    </div> <!--field contain-->

                    <div data-role="fieldcontain" >
                        <label>Profit Method:</label>
				            <fieldset data-role="controlgroup"  data-type="horizontal" >
				            <legend>&nbsp;</legend>
				            <input type="radio" name="radioCarpetOnlyOrInstalled" id="radioCarpetOnly" value="CarpentOnly" checked="checked" data-mini="true" />
				            <label for="radioCarpetOnly">Carpet Only</label>
				            <input type="radio" name="radioCarpetOnlyOrInstalled" id="radioInstalled" value="Installed"  data-mini="true" />
				            <label for="radioInstalled">Installed</label>
				            </fieldset>
                    </div> <!--field contain-->

                      <div data-role="fieldcontain" >
                      <label>Add To Profit:</label>
                        <table style="width:100%"  border="0">
                           <tr><td style="width:22%" ></td><td style="text-align:right; width:22%;  " >
                  
                           <input  type="checkbox" name="checkboxCushion" id="checkboxCushion"    data-inline="true" data-mini="true"   />
	                       <label   style="width:150px" for="checkboxCushion">Cushion</label>
                            </td><td style=" text-align:left" >
                           <input  id="inputCushion" type="number" value=""    data-inline="true"   display: inline-block;" data-mini="true" />
                          </td></tr>
                
                    <tr><td style="width:22%" ></td><td style="text-align:right;  width:22%; " >
                           <input type="checkbox" name="checkboxInstallation" id="checkboxInstallation" class="custom"   data-inline="true" data-mini="true"  />   
	                       <label  style="width:150px" for="checkboxInstallation">Installation</label>
                           </td><td style=" text-align:left" >
                           <input id="inputInstallation" type="number" value=""    data-inline="true"    display: inline-block;" data-mini="true"  />
                                </td></tr>

                    
                        <tr><td style="width:22%" ></td><td style="text-align:right;  width:22%; " >
                           <input type="checkbox" name="checkboxFreight" id="checkboxFreight" class="custom"   data-inline="true"  data-mini="true" />
	                       <label  style="width:150px" for="checkboxFreight">Freight</label>
                               </td><td style=" text-align:left" >
                           <input id="inputFreight" type="number"  value=""   data-inline="true" data-mini="true"  />
                                    </td></tr>
                    
                            <tr><td style="width:22%" ></td><td style="text-align:right; width:22%; " >
                           <input type="checkbox" name="checkboxOther" id="checkboxOther" class="custom"   data-inline="true"  data-mini="true" />
	                       <label  style="width:150px" for="checkboxOther">Other</label>
                                   </td><td style=" text-align:left" >
                           <input id="inputOther" type="number" value=""    data-inline="true"  data-mini="true" />
                                        </td></tr>
                            </table>
                   </div>
                    
                    <div data-role="fieldcontain" style="text-align:center" ><!--buttons -->
                         <div data-role="popup" id="popUpEnterDealerName" data-overlay-theme="b">
                                <p>Enter a Dealer Name Please<p>
                         </div>
                    
                    </div> <!--buttons-->
                 
                 </div> 
            </div><!--collapsible-->

            <div  id="panelWholesale" data-role="collapsible" data-collapsed="true" > <!--collapsible-->
                <h4 >Wholesale</h4>
                <h3   ><a href="#" data-rel="external" id="headerWholesaleDealerName">No Dealer Selected</a></h3>
          
                <table data-role="table" id="tableWholesale" data-mode="reflow" class="ui-responsive table-stroke" style="width:100%">
                  <thead>
                    <tr>
                      <th data-priority="1" style="width:30%">Product</th>
                      <th data-priority="persist">Whsle&nbsp;(yd)</th>
                      <th data-priority="2">Retail&nbsp;(yd)</th>
                      <th data-priority="3">Retail&nbsp;(ft)</th>
                      <th data-priority="4">&nbsp;</th>
                      <th data-priority="5">&nbsp;</th>
                    </tr>
                  </thead>
                  <tbody id="tbodyWholesale">
                 
                  <!--rows go here -->        
                  </tbody>
               </table>
    
                 
            </div> <!--collapsible-->

              
            <div   data-role="collapsible" id="panelRetail" data-collapsed="true" > <!--collapsible-->
                <h4>Retail</h4>
               <table style="width:100%"><tr><td style="width:33%"> <h3><a href="#" id="headerRetailDealerName" data-rel="external">No Dealer Selected</a></h3> 
                </td><td>
             
                    <fieldset data-role="controlgroup" data-type="horizontal"  >
                         <legend>&nbsp;</legend>
                         <input type="radio" name="radioYdFt" id="radioYdFt1" value="yd"   data-mini="true" />
                           <label for="radioYdFt1">yard</label>
                        <input type="radio" name="radioYdFt" id="radioYdFt2" value="ft"  data-mini="true" />
                          <label for="radioYdFt2">feet</label>
                         </fieldset> </td>
                 
                  
                    </td></tr></table>  
           
                <table data-role="table" id="tableRetail" data-mode="reflow" class="ui-responsive table-stroke"  style="width:100%">
                  <thead>
                    <tr>
                      <th data-priority="1">Product</th>
                      <th id="labelRetailYdFt" data-priority="persist">Retail&nbsp;(yd)</th>
                        <th  data-priority="2">Retail&nbsp;(ft)</th>
                      <th data-priority="4">Whsle&nbsp;(yd)</th>
                      <th data-priority="4"><abbr title="Rotten Tomato Rating">Whsle&nbsp;(ft)</abbr></th>
                      <th data-priority="5">Action</th>
                    </tr>
                  </thead>
                  <tbody id="tbodyRetail" >
                  
                  <!--rows go here -->   
                  </tbody>
               </table>
            </div> <!--collapsible-->


            <div data-role="panel" id="panelKeypad">
    <!-- panel content goes here -->
                 <a href="#" data-role="button" data-theme="a" data-inline="true">1</a>
                 <a href="#" data-role="button" data-theme="a" data-inline="true">2</a>
                 <a href="#" data-role="button" data-theme="a" data-inline="true">3</a>

                <a href="#panelKeypad" data-rel="close">Close panel</a>
</div><!-- /panel -->

            
            </div><!-- page-->
     

          <script >
              $(document).ready(function () {

                  $(document).on("click", ".show-page-loading-msg", function () {
                      var $this = $(this),
                          theme = $this.jqmData("theme") || $.mobile.loader.prototype.options.theme,
                          msgText = $this.jqmData("msgtext") || $.mobile.loader.prototype.options.text,
                          textVisible = $this.jqmData("textvisible") || $.mobile.loader.prototype.options.textVisible,
                          textonly = !!$this.jqmData("textonly");
                      html = $this.jqmData("html") || "";
                      $.mobile.loading("show", {
                          text: msgText,
                          textVisible: textVisible,
                          theme: theme,
                          textonly: textonly,
                          html: html
                      });
                  })

                  .on("click", ".hide-page-loading-msg", function () {
                      $.mobile.loading("hide");
                  });



                  $("#selectDealerSelection").change(onSelectDealer);
                  $("#inputDealerSelection").blur(onDealerNameBlur);

                  $('#inputBtnAdd').click(onAddDealerBtnClick);
                  $('#inputBtnSave').click(onSaveDealerClick);
                  $('#inputBtnCancel').click(onCancelDealerClick);
                  $('#inputBtnDelete').click(onDeleteDealerClick);

                  $('#topMenuDealer').click(onPanelDealerClick);
                  $('#headerRetailDealerName').click(onPanelDealerClick);
                  $('#headerWholesaleDealerName').click(onPanelDealerClick);
                  $('#topMenuSettings').click(ontopMenuSettingsClick);

                  $('#topMenuWholesale').click(onPanelWholesaleClick);
                  $('#topMenuRetail').click(onPanelRetailClick);

                  $('#inputProfitMarginOrMarkup').blur(onDealerInputBlur);
                  //$('#inputProfitMarginOrMarkup').click(onDealerInputBlur);
                  $('#inputProfitMarginOrMarkup').on("slidestop", onDealerInputBlur);


                  // $("#inputCushion").keyup(onInputKeyup);
                  $("#inputCushion").blur(onDealerInputBlur);
                  $("#checkboxCushion").click(onDealerInputBlur);

                  // $("#inputInstallation").keyup(onInputKeyup);
                  $("#inputInstallation").blur(onDealerInputBlur);
                  $("#checkboxInstallation").click(onDealerInputBlur);

                  // $("#inputFreight").keyup(onInputKeyup);
                  $("#inputFreight").blur(onDealerInputBlur);
                  $("#checkboxFreight").click(onDealerInputBlur);

                  // $("#inputOther").keyup(onInputKeyup);
                  $("#inputOther").blur(onDealerInputBlur);
                  $("#checkboxOther").click(onDealerInputBlur);

                  $("#radioCarpetOnly").click(onDealerInputBlur);
                  $("#radioInstalled").click(onDealerInputBlur);
                  $("#radioProfitMargin").click(onDealerInputBlur);
                  $("#radioMarkup").click(onDealerInputBlur);

                  $("#radioYdFt1").click(onradioYdFtClick);
                  $("#radioYdFt2").click(onradioYdFtClick);

                  function onradioYdFtClick() {

                      onDealerInputBlur();
                  }

                  //$(".carpetCost").keyup(onInputKeyup);

                  //localStorage['mohawkDealers'] = JSON.stringify("");
                  //localStorage['mohawkRetail2'] = JSON.stringify("");
                  //localStorage['mohawkRetail'] = JSON.stringify("");
                  //localStorage['mohawkWholesale'] = JSON.stringify("");


                  //$(function() {
                  //    $("#inputCushion").keyup(function () {
                  //        var curchr = this.value.length;
                  //        var curval = $(this).val();

                  //        $.formatCurrency(

                  //        $(this).parseNumber({ format: "#,###.00", locale: "us" });
                  //        $(this).formatNumber({ format: "#,###.00", locale: "us" });

                  //        //if (curchr == 3) {
                  //        //    $("input[@name='phone']").val("(" + curval + ")" + "-");
                  //        //} else if (curchr == 9) {
                  //        //    $("input[@name='phone']").val(curval + "-");
                  //        //}
                  //    });
                  //});





                  setDealerData("");




              });


              function onInputKeyup() {

                  $(this).val(formatInputToNumber($(this).val()));

              }

              function onDealerInputBlur() {

                  //alert(this.id);
                  saveDealer();
                  setDealerData($("#inputDealerSelection").val())

              }
              function onDealerNameBlur() {


                  saveDealer();
                  setDealerData($("#inputDealerSelection").val())

              }

              function onDealerInputFocus() {
                  $("#panelKeypad").panel("open")
              }

              function replaceAll(find, replace, str) {
                  while (str.indexOf(find) >= 0) {
                      str = str.replace(find, replace);
                  }
                  return str;
              }

              function formatInputToNumber(testnumber) {

                  return testnumber;
                  var formattednumber = "";
                  var testlength = 0;
                  if (testnumber == null) {
                      return "";
                  }
                  if (testnumber == undefined) {
                      return "";
                  }


                  if (testlength.length < 1) {
                      return "";
                  }


                  testnumber = replaceAll(".", "", testnumber);
                  testnumber = replaceAll(",", "", testnumber);

                  testlength = testnumber.length;

                  
                  testlength = testnumber.length;

                  if (testlength > 2) {
                      formattednumber = testnumber.substr(0, testlength - 2);
                      formattednumber = formattednumber + "." + testnumber.substr(testlength - 2, 2);
                  }
                  else {
                      //if (testnumber.length < 2) {
                      //    return "0.0".concat(testnumber);
                      //}

                      //return "0.".concat(testnumber);

                      return ".".concat(testnumber);
                  }

                  if (testnumber.length > 5) {

                      testlength = formattednumber.length;
                      part1 = testnumber.substr(0, testlength - 6);
                      part2 = testnumber.substr(testlength - 6, 3);
                      part3 = testnumber.substr(testlength - 3, 2);
                      formattednumber = part1 + "," + part2 + "." + part3;

                  }

                  return formattednumber;
              }


              function setRetailData(dealerName) {
                  //get items from storage
                  var RetailPriceCalcs = $.makeArray($.RetailPriceCalc);
                  var data = localStorage['mohawkRetail']

                  var retailYd = 0;
                  var retailYdWithMarkup = 0;
                  var retailFt = 0;
                  var wholesaleYd = 0;


                  var dealerObject = getDealerObject(dealerName);
                  if (dealerObject == null) {
                      $("#tbodyRetail").empty();
                      return;
                  }

                  $("#headerRetailDealerName").text(dealerObject.name);


                  if (data == undefined || data == null || data == "") {
                      $("#tbodyRetail").empty();
                      addBlankRetailRow(dealerObject.isRetailYd);
                      return;
                  }

                  RetailPriceCalcs = JSON.parse(data);

                  //get matching items
                  var filteredDealer = $.grep(RetailPriceCalcs, function (item) {
                      if (item != null) {
                          return item.dealerName == dealerName;
                      }
                      return 0;
                  });

                  //update UI with data
                  if (filteredDealer.length < 1) {
                      $("#tbodyRetail").empty();
                      addBlankRetailRow(dealerObject.isRetailYd);
                      return;
                  }




                  filteredDealer.sort(function (obj1, obj2) {
                      if (obj1 == null) {
                          return true;
                      }
                      if (obj2 == null) {
                          return false;
                      }

                      if (obj1.itemId == '') {
                          return true;
                      }

                      if (obj2.itemId == '') {
                          return false;
                      }

                      return obj1.itemId > obj2.itemId;
                  });


                  $("#tbodyRetail").empty();
                  var intemnumber = 0;
                  $.each(filteredDealer, function (index, retailPriceCalc) {
                      var retailYd = 0;
                      var retailYdWithMarkup = 0;
                      var retailFt = 0;
                      var wholesaleYd = 0;

                      if (retailPriceCalc != null) {
                          //calculate total here
                          wholesaleYd = parseFloat(retailPriceCalc.wholesaleYd);
                          if (dealerObject.carpetonly == 'false') {
                              if (dealerObject.usecushion == "true") {
                                  //do it
                                  retailYdWithMarkup = retailYdWithMarkup + parseFloat(dealerObject.cushion);
                              }
                              else {
                                  retailYd = parseFloat(retailYd) + parseFloat(dealerObject.cushion);
                              }


                              if (dealerObject.useinstallation == "true") {
                                  //do it
                                  retailYdWithMarkup = retailYdWithMarkup + parseFloat(dealerObject.installation)
                              }
                              else {
                                  retailYd = parseFloat(retailYd) + parseFloat(dealerObject.installation);
                              }

                              if (dealerObject.usefreight == "true") {
                                  //do it
                                  retailYdWithMarkup = retailYdWithMarkup + parseFloat(dealerObject.freight)
                              }
                              else {
                                  retailYd = parseFloat(retailYd) + parseFloat(dealerObject.freight);
                              }


                              if (dealerObject.useother == "true") {
                                  //do it
                                  retailYdWithMarkup = retailYdWithMarkup + parseFloat(dealerObject.other)
                              }
                              else {
                                  retailYd = parseFloat(retailYd) + parseFloat(dealerObject.other);
                              }
                          }

                          var total = 0;
                          var multiplier = 0;
                          var ydWithMarkup = retailYdWithMarkup;
                          var ydWholesale = wholesaleYd;

                          if (dealerObject.useprofit == "false") {

                              multiplier = parseInt(dealerObject.profit) / 100 + 1;
                              total = ((((ydWholesale - retailYd) / multiplier)) - ydWithMarkup).toFixed(2);
                          }
                          else {

                              multiplier = parseFloat((1 - (parseFloat(dealerObject.markup) / 100)).toFixed(2));
                              total = (((ydWholesale - retailYd) * multiplier) - ydWithMarkup).toFixed(2);
                          }

                          retailYd = total;

                          retailFt = (retailYd / 9).toFixed(2);
                       
                          if (retailPriceCalc.wholesaleYd > 0) {
                              var yardby9 = (retailPriceCalc.wholesaleYd / 9).toFixed(2);
                          }
                          else {
                              yardby9 = 0;
                          }

                          
                          addRetailRow(retailPriceCalc.productName, retailPriceCalc.wholesaleYd, yardby9, retailYd, retailFt, false, true, retailPriceCalc.itemId, dealerObject.isRetailYd);
                      }


                  });
                  //add a blank row
                  addBlankRetailRow(dealerObject.isRetailYd);
                  $("#tableRetail").table("refresh");
              }



              function setWholesaleData(dealerName) {
                  //get items from storage
                  var WholesalePriceCalcs = $.makeArray($.WholesalePriceCalc);
                  var data = localStorage['mohawkWholesale']

                  var retailYd = 0;
                  var retailYdWithMarkup = 0;
                  var retailFt = 0;
                  var wholesaleYd = 0;
                  var headerDetails = '';

                  var dealerObject = getDealerObject(dealerName);
                  if (dealerObject == null) {
                      $("#tbodyWholesale").empty();
                      return;
                  }

                  $("#headerWholesaleDealerName").text(dealerObject.name);

                 

                  if (data == undefined || data == null || data == "") {
                      $("#tbodyWholesale").empty();
                      addBlankRow();
                      return;
                  }

                  WholesalePriceCalcs = JSON.parse(data);

                  //get matching items
                  var filteredDealer = $.grep(WholesalePriceCalcs, function (item) {
                      if (item != null) {
                          return item.dealerName == dealerName;
                      }
                      return 0;
                  });

                  //update UI with data
                  if (filteredDealer.length < 1) {
                      $("#tbodyWholesale").empty();
                      addBlankRow();
                      return;
                  }


                  filteredDealer.sort(function (obj1, obj2) {
                      if (obj1 == null) {
                          return true;
                      }
                      if (obj2 == null) {
                          return false;
                      }

                      if (obj1.itemId == '') {
                          return true;
                      }

                      if (obj2.itemId == '') {
                          return false;
                      }

                      return obj1.itemId > obj2.itemId;
                  });


                  $("#tbodyWholesale").empty();
                  var intemnumber = 0;
                  $.each(filteredDealer, function (index, wholesalePriceCalc) {
                      var retailYd = 0;
                      var retailYdWithMarkup = 0;
                      var retailFt = 0;
                      var wholesaleYd = 0;

                      if (wholesalePriceCalc != null) {
                          //calculate total here
                          wholesaleYd = parseFloat(wholesalePriceCalc.wholesaleYd).toFixed(2);
                          if (dealerObject.carpetonly == 'false') {
                              if (dealerObject.usecushion == "true") {
                                  //do it
                                  retailYdWithMarkup = retailYdWithMarkup + parseFloat(dealerObject.cushion);
                              }
                              else {
                                  retailYd = parseFloat(retailYd) + parseFloat(dealerObject.cushion);
                              }


                              if (dealerObject.useinstallation == "true") {
                                  //do it
                                  retailYdWithMarkup = retailYdWithMarkup + parseFloat(dealerObject.installation)
                              }
                              else {
                                  retailYd = parseFloat(retailYd) + parseFloat(dealerObject.installation);
                              }

                              if (dealerObject.usefreight == "true") {
                                  //do it
                                  retailYdWithMarkup = retailYdWithMarkup + parseFloat(dealerObject.freight)
                              }
                              else {
                                  retailYd = parseFloat(retailYd) + parseFloat(dealerObject.freight);
                              }


                              if (dealerObject.useother == "true") {
                                  //do it
                                  retailYdWithMarkup = retailYdWithMarkup + parseFloat(dealerObject.other)
                              }
                              else {
                                  retailYd = parseFloat(retailYd) + parseFloat(dealerObject.other);
                              }
                          }

                          var total = 0;
                          var multiplier = 0;
                          var ydWithMarkup = retailYdWithMarkup;
                          var ydWholesale = parseFloat(wholesaleYd);
                          if (dealerObject.useprofit == "false") {

                              multiplier = parseInt(dealerObject.profit) / 100 + 1;
                              total = ((multiplier * (ydWithMarkup + ydWholesale)) + retailYd).toFixed(2);
                          }
                          else {

                             
                              multiplier = parseFloat((1 - (parseFloat(dealerObject.markup) / 100)).toFixed(2));
                              total = (((ydWithMarkup + ydWholesale) / multiplier) + retailYd).toFixed(2);
                          }

                         
                          retailYd = total;

                          retailFt = (retailYd / 9).toFixed(2);
                          addRow(wholesalePriceCalc.productName, ydWholesale, retailYd, retailFt, false, true, wholesalePriceCalc.itemId);
                      }

                  });
                  //add a blank row
                  addBlankRow();
                  $("#tableWholesale").table("refresh");

              }

              function saveWholesale(itemId, dealerName, productName, wholesaleYd) {
                  deleteWholesale(dealerName, itemId);

                  addWholesale(itemId, dealerName, productName, wholesaleYd);

              }

              function saveRetail(itemId, dealerName, productName, retailYd, retailFt) {
                  deleteRetail(dealerName, itemId);

                  addRetail(itemId, dealerName, productName, retailYd, retailFt);

              }

              function deleteWholesale(dealerName, itemId) {
                  //get items from storage
                  var WholesalePriceCalcs = $.makeArray($.WholesalePriceCalc);
                  var data = localStorage['mohawkWholesale'];
                  var filteredDealer;
                  if (data != undefined && data != null && data != "") {
                      WholesalePriceCalcs = JSON.parse(data);

                      //get matching items
                      var filteredDealer = $.grep(WholesalePriceCalcs, function (item) {
                          if (item != null) {
                              return item.itemId != itemId;
                          }
                          return 0;
                      });

                     
                      if (filteredDealer.length > 0) {
                          filteredDealer.sort(function (obj1, obj2) {
                              if (obj1 == null) {
                                  return true;
                              }
                              if (obj2 == null) {
                                  return false;
                              }

                              if (obj1.productname == '') {
                                  return true;
                              }

                              if (obj2.productname == '') {
                                  return false;
                              }

                              return obj1.productName > obj2.productName;
                          });
                      }

                      //save to storage
                      localStorage['mohawkWholesale'] = JSON.stringify(filteredDealer);
                  }
              }


              function deleteWholesaleByDealerName(dealerName) {
                  //get items from storage
                  var WholesalePriceCalcs = $.makeArray($.WholesalePriceCalc);
                  var data = localStorage['mohawkWholesale'];
                  var filteredDealer;
                  if (data != undefined && data != null && data != "") {
                      WholesalePriceCalcs = JSON.parse(data);

                      //get matching items
                      var filteredDealer = $.grep(WholesalePriceCalcs, function (item) {
                          if (item != null) {
                              return item.dealerName != dealerName;
                          }
                          return 0;
                      });

                      //update UI with data
                      if (filteredDealer.length < 1) {
                          //abandon
                          return;
                      }



                      filteredDealer.sort(function (obj1, obj2) {
                          if (obj1 == null) {
                              return true;
                          }
                          if (obj2 == null) {
                              return false;
                          }

                          if (obj1.productname == '') {
                              return true;
                          }

                          if (obj2.productname == '') {
                              return false;
                          }

                          return obj1.productName > obj2.productName;
                      });


                      //save to storage
                      localStorage['mohawkWholesale'] = JSON.stringify(filteredDealer);
                  }
              }


              function deleteRetail(dealerName, itemId) {
                  //get items from storage
                  var RetailPriceCalcs = $.makeArray($.RetailPriceCalc);
                  // remove all data 
                  //localStorage['mohawkRetail2'] = JSON.stringify("");
                  var data = localStorage['mohawkRetail'];
                  var filteredDealer;
                  if (data != undefined && data != null && data != "") {
                      RetailPriceCalcs = JSON.parse(data);

                      //get matching items
                      var filteredDealer = $.grep(RetailPriceCalcs, function (item) {
                          if (item != null) {
                              return item.itemId != itemId;
                          }
                          return 0;
                      });

                      

                      if (filteredDealer.length > 0) {
                          filteredDealer.sort(function (obj1, obj2) {
                              if (obj1 == null) {
                                  return true;
                              }
                              if (obj2 == null) {
                                  return false;
                              }

                              if (obj1.productname == '') {
                                  return true;
                              }

                              if (obj2.productname == '') {
                                  return false;
                              }

                              return obj1.productName > obj2.productName;
                          });
                      }


                      //save to storage
                      localStorage['mohawkRetail'] = JSON.stringify(filteredDealer);
                  }
              }


              function deleteRetailByDealerName(dealerName) {
                  //get items from storage
                  var RetailPriceCalcs = $.makeArray($.RetailPriceCalc);

                  var data = localStorage['mohawkRetail'];
                  var filteredDealer;
                  if (data != undefined && data != null && data != "") {
                      RetailPriceCalcs = JSON.parse(data);

                      //get matching items
                      var filteredDealer = $.grep(RetailPriceCalcs, function (item) {
                          if (item != null) {
                              return item.dealerName != dealerName;
                          }
                          return 0;
                      });

                      //update UI with data
                      if (filteredDealer.length < 1) {
                          //alert(item + " already exist");
                          return;
                      }



                      filteredDealer.sort(function (obj1, obj2) {
                          if (obj1 == null) {
                              return true;
                          }
                          if (obj2 == null) {
                              return false;
                          }

                          if (obj1.productname == '') {
                              return true;
                          }

                          if (obj2.productname == '') {
                              return false;
                          }

                          return obj1.productName > obj2.productName;
                      });


                      //save to storage
                      localStorage['mohawkRetail'] = JSON.stringify(filteredDealer);
                  }
              }


              function addWholesale(itemId, dealerName, productName, wholesaleYd) {
                  //get items from storage
                  var retailYd = 0;
                  var retailYdWithMarkup = 0;
                  var retailFt = 0;

                  if (wholesaleYd == null) {
                      wholesaleYd = "0";
                  }

                  var WholesalePriceCalcs = $.makeArray($.WholesalePriceCalc);
                  var data = localStorage['mohawkWholesale']

                  if (data != undefined && data != null && data != "") {

                      WholesalePriceCalcs = JSON.parse(data);

                      var maxID = 0;
                      //get matching items
                      var filteredDealer = $.grep(WholesalePriceCalcs, function (item) {
                          if (item != null) {
                              return item.itemId == itemId;
                          }
                          return 0;
                      });

                      //update UI with data
                      if (filteredDealer.length > 0) {
                          //already exist
                          return;
                      }


                  }
                  if (itemId == null || itemId == "") {
                      itemId = (new Date()).getTime();
                  }

                  //create new item
                  var myPriceCalc = new $.WholesalePriceCalc(dealerName, productName, wholesaleYd, '0', '0', itemId);
                  WholesalePriceCalcs.push(myPriceCalc);


                  WholesalePriceCalcs.sort(function (obj1, obj2) {
                      if (obj1 == null) {
                          return true;
                      }
                      if (obj2 == null) {
                          return false;
                      }

                      if (obj1.productname == '') {
                          return true;
                      }

                      if (obj2.productname == '') {
                          return false;
                      }

                      return obj1.productName > obj2.productName;
                  });

                  //save to storage
                  localStorage['mohawkWholesale'] = JSON.stringify(WholesalePriceCalcs);
              }


              function addRetail(itemId, dealerName, productName, retailYd, retailFt) {
                  //get items from storage
                  var retailYdWithMarkup = 0;
                  var retailFt = 0;

                  if (retailYd == null) {
                      retailYd = "0";
                  }

                  var RetailPriceCalcs = $.makeArray($.RetailPriceCalc);
                  var data = localStorage['mohawkRetail']

                  if (data != undefined && data != null && data != "") {


                      RetailPriceCalcs = JSON.parse(data);

                      var maxID = 0;
                      //get matching items
                      var filteredDealer = $.grep(RetailPriceCalcs, function (item) {
                          if (item != null) {
                              return item.itemId == itemId;
                          }
                          return 0;
                      });

                      //update UI with data
                      if (filteredDealer.length > 0) {
                          //already exist
                          return;
                      }
                  }

                  if (itemId == null || itemId == "") {
                      itemId = (new Date()).getTime();
                  }

                  //create new item
                  var myPriceCalc = new $.RetailPriceCalc(dealerName, productName, retailYd, retailYd, retailFt, itemId);
                  RetailPriceCalcs.push(myPriceCalc);

                  RetailPriceCalcs.sort(function (obj1, obj2) {
                      if (obj1 == null) {
                          return true;
                      }
                      if (obj2 == null) {
                          return false;
                      }

                      if (obj1.productname == '') {
                          return true;
                      }

                      if (obj2.productname == '') {
                          return false;
                      }

                      return obj1.productName > obj2.productName;
                  });


                  //save to storage
                  localStorage['mohawkRetail'] = JSON.stringify(RetailPriceCalcs);
              }

              function onPanelDealerClick() {
                  $('#panelDealer').trigger('expand');
                  $('#panelRetail').trigger('collapse');
                  $('#panelWholesale').trigger('collapse');
                  location.href = "#panelDealer";
              }

              function ontopMenuSettingsClick() {
                  alert("Version 1.0.4");
              };

              function onPanelWholesaleClick() {

                  $('#panelDealer').trigger('collapse');
                  $('#panelRetail').trigger('collapse');
                  $('#panelWholesale').trigger('expand');
                  location.href = "#panelWholesale";
              }

              function onPanelRetailClick() {

                  $('#panelDealer').trigger('collapse');
                  $('#panelRetail').trigger('expand');
                  $('#panelWholesale').trigger('collapse');
                  location.href = "#panelRetail";
              }

              function onWholesaleCostSaveButtonClick() {
                  var myArray = this.id.split('_');
                  var dealerName = $("#selectDealerSelection").val();
                  var productName = $("#wholesaleProduct_" + myArray[1]).val();
                  var wholesaleYd = $("#wholesaleCost_" + myArray[1]).val();
                  var itemId = myArray[1];
                  if (dealerName == "") {
                      alert("Please select a dealer");
                      return;
                  }
                  if (wholesaleYd == "") {
                      alert("Please enter wholesale amount");
                      return;
                  }
                 

                  saveWholesale(itemId, dealerName, productName, wholesaleYd);
                  setDealerData(dealerName);

              }

              function onRetailCostSaveButtonClick() {
                  var myArray = this.id.split('_');
                  var dealerName = $("#selectDealerSelection").val();
                  var productName = $("#retailProduct_" + myArray[1]).val();
                  var retailYd = $("#retailCost_" + myArray[1]).val();
                  var retailFt = $("#retailCostFt_" + myArray[1]).val();
                  var itemId = myArray[1];
                  if (dealerName == "") {
                      alert("Please select a dealer");
                      return;
                  }
                  
                  var test = $('[name=radioYdFt]:checked').val();

                  if (test == "ft") {
                      if (retailFt == "") {
                          alert("Please enter retail amount");
                          return;
                      }

                     
                      retailYd = (retailFt * 9).toFixed(2);
                  }
                  else {
                      if (retailYd == "") {
                          alert("Please enter retail amount");
                          return;
                      }


                      retailFt = (retailYd / 9).toFixed(2);
                  }

                  saveRetail(itemId, dealerName, productName, retailYd, retailFt);
                  setDealerData(dealerName);

              }

              function addBlankRow() {
                  addRow('', '', '0', '0', true, false, '', true);
              }

              function addBlankRetailRow(RetailYd) {
                  addRetailRow('', '', '', '0', '0', true, false, '', RetailYd);
              }

              function addRow(wholesaleProduct, wholesaleAmount, retailYd, retailFt, boolIncludeSave, boolIncludeDelete, itemId) {

                  if (itemId == null || itemId == "") {
                      itemId = (new Date()).getTime();

                  }
                  boolIncludeSave = true;

                  var mytable = '<tr>';

                  if (boolIncludeSave) {
                      mytable = mytable + ' <th  > <input   id="wholesaleProduct_' + itemId + '" type="text"  placeholder="Optional Product" value="' + wholesaleProduct + '"  /></th>';

                  } else {

                      mytable = mytable + ' <td>  <a href="." data-rel="external">' + wholesaleProduct + '</a></td>';
                  }

                  if (boolIncludeSave) {
                      mytable = mytable + ' <td><input class="carpetCost" id="wholesaleCost_' + itemId + '"  type="number"  placeholder="Enter Wholesale $0.00"  value="' + wholesaleAmount + '"  /></td>';
                  }
                  else {
                      mytable = mytable + ' <td> ' + wholesaleAmount + '</td>';
                  }
                  mytable = mytable + ' <td>$' + retailYd + '</td>';
                  mytable = mytable + ' <td>$' + retailFt + '</td>';



                  if (boolIncludeSave) {
                      mytable = mytable + '<td><button id="btnwholesaleCostSave_' + itemId + '"  data-role="button" data-icon="add" data-iconpos="right" data-inline="true" data-theme="b"  data-mini="true">Save</button></td>';
                  }
                  if (boolIncludeDelete) {
                      mytable = mytable + '<td><a data-rel="external" id="btnwholesaleCostDelete_' + itemId + '" href="#" data-role="button" data-icon="delete" data-iconpos="right" data-inline="true" data-mini="true">Delete</a></td>';
                  }

                  mytable = mytable + '               </tr> ';


                  $("#tbodyWholesale").append(mytable);



                  $("#btnwholesaleCostDelete_" + itemId).click(onWholesaleCostDeleteButtonClick);


                  if (boolIncludeSave) {
                      //$("#tableWholesale").table("refresh");
                      $("#btnwholesaleCostSave_" + itemId).click(onWholesaleCostSaveButtonClick);
                      // $("#wholesaleCost_" + itemId).keyup(onInputKeyup);
                      $("#tableWholesale").trigger("create");

                  }

              }


              function addRetailRow(retailProduct, retailAmountYd, retailAmountFt, wholesaleYd, wholesaleFt, boolIncludeSave, boolIncludeDelete, itemId, retailYd) {

                  if (itemId == null || itemId == "") {
                      itemId = (new Date()).getTime();

                  }

                  if(retailYd == undefined  || retailYd == null || retailYd == "")
                  {
                      retailYd = "true";
                  }

                  boolIncludeSave = true;

                  var mytable = '<tr>';

                 
                  mytable = mytable + ' <td  > <input  id="retailProduct_' + itemId + '" type="text"  placeholder="Optional Product"  value="' + retailProduct + '"  /></td>';

                  
                
                  mytable = mytable + ' <td><input  class="carpetCost" id="retailCost_' + itemId + '"  type="number"  placeholder="Enter Retail $0.00"  value="' + retailAmountYd + '" ';

                  if (toBool(retailYd)) {
                      mytable = mytable + ' /></td>';
                  }
                  else {
                      mytable = mytable + ' disabled  /></td>';
                  }
               
                  mytable = mytable + ' <td><input  class="carpetCost" id="retailCostFt_' + itemId + '"  type="number"  placeholder="Enter Retail $0.00"  value="' + retailAmountFt + '" ';

                  if (toBool(retailYd)) {
                      mytable = mytable + ' disabled /></td>';
                  }
                  else {
                      mytable = mytable + ' /></td>';
                  }

                  mytable = mytable + ' <td>$' + wholesaleYd + '</td>';
                  mytable = mytable + ' <td>$' + wholesaleFt + '</td>';




                  if (boolIncludeSave) {
                      mytable = mytable + '<td><button id="btnretailCostSave_' + itemId + '"  data-role="button" data-icon="add" data-iconpos="right" data-inline="true" data-theme="b"  data-mini="true" >Save</button></td>';
                  }

                  if (boolIncludeDelete) {
                      mytable = mytable + '<td><a data-rel="external" id="btnretailCostDelete_' + itemId + '" href="#" data-role="button" data-icon="delete" data-iconpos="right" data-inline="true"  data-mini="true"  >Delete</a></td>';
                  }

                  mytable = mytable + '               </tr> ';


                  $("#tbodyRetail").append(mytable);


                  $("#btnretailCostDelete_" + itemId).click(onRetailCostDeleteButtonClick);


                  if (boolIncludeSave) {
                      //$("#tableWholesale").table("refresh");

                      $("#btnretailCostSave_" + itemId).click(onRetailCostSaveButtonClick);
                      //  $("#retailCost_" + itemId).keyup(onInputKeyup);
                      $("#tableRetail").trigger("create");

                  }


              }

              function clearAll() {
                  $('#selectDealerSelection option:selected').removeAttr('selected');
                  $('#selectDealerSelection').val('');
                  $("#inputDealerSelection").val('');
                  $("#inputProfitMargin").val('0.00');
                  $("#inputMarkup").val('0.00');

                  $("#inputProfitMarginOrMarkup").val('0');
                  setCheckedAttr("radioMarkup", "false");
                  setCheckedAttr("radioProfitMargin", "false");


                  $("#inputCushion").val('0.00');
                  setCheckedAttr("checkboxCushion", 'true');

                  $("#inputInstallation").val('0.00');
                  setCheckedAttr("checkboxInstallation", 'true');
                  setDisabledByCheckBox("inputInstallation", 'true');

                  $("#inputFreight").val('0.00');
                  setCheckedAttr("checkboxFreight", 'true');

                  $("#inputOther").val('0.00');
                  setCheckedAttr("checkboxOther", 'true');
              }



              function onWholesaleCostDeleteButtonClick() {
                  var myArray = this.id.split('_');
                  var dealerName = $("#selectDealerSelection").val();
                  var productName = $("#wholesaleProduct_" + myArray[1]).val();
                  var itemId = myArray[1];

                  deleteWholesale(dealerName, itemId);
                  setDealerData(dealerName);
              }

              function onRetailCostDeleteButtonClick() {
                  var myArray = this.id.split('_');
                  var dealerName = $("#selectDealerSelection").val();
                  var productName = $("#retailProduct_" + myArray[1]).val();
                  var itemId = myArray[1];

                  deleteRetail(dealerName, itemId);
                  setDealerData(dealerName);
              }


              function onSelectDealer() {
                  $("#inputDealerSelection").val($("#selectDealerSelection :selected").text());
                  
                  setDealerData($("#selectDealerSelection :selected").text());

              }

              function onAddDealerBtnClick() {
                  $('#selectDealerSelection').addClass("ui-hidden-accessible");
                  clearAll();
                  var newDealerName = getNewDealerName();

                  $("#inputDealerSelection").val(newDealerName);

                  $('#selectDealerSelection option:selected').removeAttr('selected');
                  $('#selectDealerSelection').val(newDealerName);
                  $("#selectDealerSelection").selectmenu("refresh");
                  saveDealer();
                  setDealerData($("#inputDealerSelection").val());

                  $("#inputDealerSelection").focus();

               
              }


              $.WholesalePriceCalc = function (dealerName, productName, wholesaleYd, retailYd, retailFt, itemId) {

                  this.dealerName = dealerName
                  this.productName = productName;
                  this.wholesaleYd = wholesaleYd;
                  //this.retailYd = retailYd;
                  //this.retailFt = retailFt;
                  this.itemId = itemId;
              }

              $.RetailPriceCalc = function (dealerName, productName, wholesaleYd, retailYd, retailFt, itemId) {
                  this.dealerName = dealerName
                  this.productName = productName;
                  this.wholesaleYd = wholesaleYd;
                  //this.retailYd = retailYd;
                  //this.retailFt = retailFt;
                  this.itemId = itemId;
              }


              $.Dealer = function (name, profit, markup, useprofit, carpetonly, cushion, usecushion, installation, useinstallation, freight, usefreight, other, useother, isRetailYd) {

                  this.name = name;
                  this.profit = profit;
                  this.markup = markup;
                  this.useprofit = useprofit;
                  this.carpetonly = carpetonly;
                  this.cushion = cushion;
                  this.usecushion = usecushion;
                  this.installation = installation;
                  this.useinstallation = useinstallation;
                  this.freight = freight;
                  this.usefreight = usefreight;
                  this.other = other;
                  this.useother = useother;
                  this.isRetailYd = isRetailYd
              }


              function setDealerData(dealerName) {

                  //get Dealers from storage
                  var Dealers = $.makeArray($.Dealer);
                  var data = localStorage['mohawkDealers']

                  $('#selectDealerSelection').removeClass("ui-hidden-accessible");
               
                  $('#inputBtnAdd').removeClass("ui-hidden-accessible");

                  if (data == undefined || data == null || data == "") {
                      return null;
                  }

                  Dealers = JSON.parse(data);

                  SortedDealers = Dealers.sort(function (obj1, obj2) {
                      if (obj1 == null) {
                          return true;
                      }
                      if (obj2 == null) {
                          return false;
                      }

                      if (obj1.name == '') {
                          return true;
                      }

                      if (obj2.name == '') {
                          return false;
                      }

                      return obj1.name > obj2.name;
                  });


                  //build select 
                  $("#selectDealerSelection").empty();
                  if (dealerName == '') {
                      $("#selectDealerSelection").append('<option value="" selected >CHOOSE DEALER</option>');
                  }
                  else {
                      $("#selectDealerSelection").append('<option value=""  >CHOOSE DEALER</option>');
                  }
                  $.each(SortedDealers, function (index, dealer) {
                      var selected = '';
                      if (dealer != null) {
                          selected = '';
                          if (dealer.name == dealerName) {
                              selected = 'selected';
                          }



                          $("#selectDealerSelection").append('<option value="' + dealer.name + '" ' + selected + ' >' + dealer.name + '</option>');
                      }
                  });
                  $("#selectDealerSelection").selectmenu("refresh");

                  //get matching dealer
                  var filteredDealer = $.grep(Dealers, function (item) {
                      if (item != null) {
                          return item.name == dealerName;
                      }
                      return 0;
                  });

                  //update UI with data
                  var index = 0;
                  if (filteredDealer.length > 0) {

                      if (filteredDealer[0] == null) {
                          index = 1;
                      }

                      if (filteredDealer[index].profit == null || filteredDealer[index].profit == undefined) {
                          filteredDealer[index].profit = "0";
                      }

                      $("#inputProfitMarginOrMarkup").val(filteredDealer[index].profit);

                      if (filteredDealer[index].useprofit.toLowerCase() == "true") {
                          setChecked("radioMarkup", "false");
                          setChecked("radioProfitMargin", "true");
                      }
                      else {
                          setChecked("radioMarkup", "true");
                          setChecked("radioProfitMargin", "false");
                      }


                      if (filteredDealer[index].carpetonly.toLowerCase() == "true") {
                          setChecked("radioCarpetOnly", "true");
                          setChecked("radioInstalled", "false");
                      }
                      else {
                          setChecked("radioCarpetOnly", "false");
                          setChecked("radioInstalled", "true");
                      }



                      if (filteredDealer[index].isRetailYd == undefined || filteredDealer[index].isRetailYd.toLowerCase() == "true") {
                          setChecked("radioYdFt1", "true");
                          setChecked("radioYdFt2", "false");
                      } else {
                          setChecked("radioYdFt1", "false");
                          setChecked("radioYdFt2", "true");
                      }


                      $("#inputCushion").val(parseFloat(filteredDealer[index].cushion).toFixed(2));
                      setChecked("checkboxCushion", filteredDealer[index].usecushion);


                      $("#inputInstallation").val(parseFloat(filteredDealer[index].installation).toFixed(2));
                      setChecked("checkboxInstallation", filteredDealer[index].useinstallation);


                      $("#inputFreight").val(parseFloat(filteredDealer[index].freight).toFixed(2));
                      setChecked("checkboxFreight", filteredDealer[index].usefreight);


                      $("#inputOther").val(parseFloat(filteredDealer[index].other).toFixed(2));
                      setChecked("checkboxOther", filteredDealer[index].useother);

                  }

                  setWholesaleData(dealerName);
                  setRetailData(dealerName);

              }


              function getNewDealerName() {
                  var Dealers = $.makeArray($.Dealer);
                  var data = localStorage['mohawkDealers']
                  var maxNumber = 1;
                  if (data != undefined && data != null && data != "") {
                      Dealers = JSON.parse(data);

                      //get matching dealer
                      var filteredDealer = $.grep(Dealers, function (item) {
                          if (item != null) {
                              //return item.name == dealerName;
                              var str = item.name;
                              var dealerNumber;
                              if (str.match("^Dealer_")) {

                                  var myArray = item.name.split('_');

                                  if (myArray.length > 1) {
                                      dealerNumber = parseInt(myArray[1]);
                                  }
                                  else {
                                      dealerNumber = 1;
                                  }

                                  if (dealerNumber > maxNumber) {
                                      maxNumber = dealerNumber
                                  }
                                  return true;
                              }
                          }
                          return 0;
                      });

                      return "Dealer_" + (maxNumber + 1).toString();
                  }
                  return "Dealer_1";
              }


              function addDealer(dealerName, profitMargin, markup, useProfit, carpetonly, cushion, useCushion, installation, useInstallation, freight, useFreight, other, useOther, isRetailYd) {
                  //get Dealers from storage
                  var Dealers = $.makeArray($.Dealer);
                  var data = localStorage['mohawkDealers']

                  if (data != undefined && data != null && data != "") {
                      Dealers = JSON.parse(data);

                      //get matching dealer
                      var filteredDealer = $.grep(Dealers, function (item) {
                          if (item != null) {
                              return item.name == dealerName;
                          }
                          return 0;
                      });

                      //update UI with data
                      if (filteredDealer.length > 0) {
                          //abandon
                          return;
                      }
                  }
                  //create new dealer

                  var myDealer = new $.Dealer(dealerName, profitMargin, markup, useProfit, carpetonly, cushion, useCushion, installation, useInstallation, freight, useFreight, other, useOther, isRetailYd);
                  Dealers.push(myDealer);


                  Dealers.sort(function (obj1, obj2) {
                      if (obj1 == null) {
                          return true;
                      }
                      if (obj2 == null) {
                          return false;
                      }

                      if (obj1.name == '') {
                          return true;
                      }

                      if (obj2.name == '') {
                          return false;
                      }

                      return obj1.name > obj2.name;
                  });


                  //save to storage
                  localStorage['mohawkDealers'] = JSON.stringify(Dealers);

              }

              function getDealerObject(dealerName) {
                  //get Dealer from storage
                  var Dealers = $.makeArray($.Dealer);
                  var data = localStorage['mohawkDealers']
                  if (data == undefined || data == null || data == "") {
                      return null
                  }
                  Dealers = JSON.parse(data);

                  //get matching dealer
                  var filteredDealer = $.grep(Dealers, function (item) {
                      if (item != null) {
                          return item.name == dealerName;
                      }
                      return 0;
                  });


                  if (filteredDealer.length >= 1) {

                      return filteredDealer[0];
                  }
                  return null;

              }

              function deleteDealer(dealerName, profitMargin, markup, useProfit, carpetonly, cushion, useCushion, installation, useInstallation, freight, useFreight, other, useOther, isRetailYd) {
                  //get Dealers from storage
                  var Dealers = $.makeArray($.Dealer);
                  var data = localStorage['mohawkDealers']

                  if (data == undefined && data == null && data == "") {
                      return;
                  }

                  Dealers = JSON.parse(data);

                  //get matching dealer
                  var filteredDealer = $.grep(Dealers, function (item) {
                      if (item != null) {
                          return item.name != dealerName;
                      }
                      return 0;
                  });

                 

                  if (filteredDealer.length > 0) {
                      filteredDealer.sort(function (obj1, obj2) {
                          if (obj1 == null) {
                              return true;
                          }
                          if (obj2 == null) {
                              return false;
                          }

                          if (obj1.name == '') {
                              return true;
                          }

                          if (obj2.name == '') {
                              return false;
                          }

                          return obj1.name > obj2.name;
                      });
                  }

                  //save to storage
                  localStorage['mohawkDealers'] = JSON.stringify(filteredDealer);

                  deleteWholesaleByDealerName(dealerName);
                  deleteRetailByDealerName(dealerName);

              }


              function DAsaveDealer(selectedDealerName, dealerName, profitMargin, markup, useProfit, carpetonly, cushion, useCushion, installation, useInstallation, freight, useFreight, other, useOther, isRetailYd) {
                  //get Dealers from storage
                  var Dealers = $.makeArray($.Dealer);
                  var data = localStorage['mohawkDealers']
                  var filteredDealer;

                  if (dealerName == null || dealerName == '') {

                      return;
                  }

                  if (data != undefined && data != null && data != "") {

                      Dealers = JSON.parse(data);

                      //get matching dealer
                      filteredDealer = $.grep(Dealers, function (item) {
                          if (item != null) {
                              return item.name != selectedDealerName;
                          }
                          return 0;
                      });


                      if (filteredDealer.length < 0) {

                          return;
                      }
                  }
                  else {
                      var filteredDealer = $.makeArray($.Dealer);
                  }
                  //create new dealer
                  var myDealer = new $.Dealer(dealerName, profitMargin, markup, useProfit, carpetonly, cushion, useCushion, installation, useInstallation, freight, useFreight, other, useOther, isRetailYd);
                  filteredDealer.push(myDealer);



                  filteredDealer.sort(function (obj1, obj2) {
                      if (obj1 == null) {
                          return true;
                      }
                      if (obj2 == null) {
                          return false;
                      }

                      if (obj1.name == '') {
                          return true;
                      }

                      if (obj2.name == '') {
                          return false;
                      }

                      return obj1.name > obj2.name;
                  });


                  //save to storage
                  localStorage['mohawkDealers'] = JSON.stringify(filteredDealer);

              }


              function onAddDealerClick() {
                  var dealerName = $("#inputDealerSelection").val();
                  var profitMargin = $("#inputProfitMargin").val();
                  var markup = $("#inputMarkup").val();
                  var useProfit = $("#radioProfitMargin").is(':checked').toString();
                  var carpetonly = $("#radioCarpetOnly").is(':checked').toString();
                  var cushion = $("#inputCushion").val();
                  var useCushion = $("#checkboxCushion").is(':checked').toString();
                  var installation = $("#inputInstallation").val();;
                  var useInstallation = $("#checkboxInstallation").is(':checked').toString();
                  var freight = $("#inputFreight").val();
                  var useFreight = $("#checkboxFreight").is(':checked').toString();
                  var other = $("#inputOther").val();
                  var useOther = $("#checkboxOther").is(':checked').toString();
                  var isRetailYd = $("#retailYdFt1").is(':checked').toString();

                  addDealer(dealerName, profitMargin, markup, useProfit, carpetonly, cushion, useCushion, installation, useInstallation, freight, useFreight, other, useOther, isRetailYd);
                  setDealerData(dealerName);
                  hideButtons();
              }

              function onSaveDealerClick() {
                  var selectedDealerName = $("#selectDealerSelection").val();
                  var dealerName = $("#inputDealerSelection").val();
                  if (dealerName == null || dealerName == '') {
                      $("#popUpEnterDealerName").popup("open");
                      return;
                  }

                  saveDealer();

                  setDealerData(dealerName);
                  hideButtons();
              }

              function saveDealer() {
                  var selectedDealerName = $("#selectDealerSelection").val();
                  var dealerName = $("#inputDealerSelection").val();
                  if (dealerName == null || dealerName == '') {
                      return;
                  }

                  var profitMargin = $("#inputProfitMarginOrMarkup").val();
                  var carpetonly = $("#radioCarpetOnly").is(':checked').toString();

                  var markup = $("#inputProfitMarginOrMarkup").val();
                  var useProfit = $("#radioProfitMargin").is(':checked').toString();

                  var cushion = $("#inputCushion").val();
                  var useCushion = $("#checkboxCushion").is(':checked').toString();
                  var installation = $("#inputInstallation").val();;
                  var useInstallation = $("#checkboxInstallation").is(':checked').toString();
                  var freight = $("#inputFreight").val();
                  var useFreight = $("#checkboxFreight").is(':checked').toString();
                  var other = $("#inputOther").val();
                  var useOther = $("#checkboxOther").is(':checked').toString();

                  var isRetailYd = $("#radioYdFt1").is(':checked').toString();

                  if (profitMargin == 'undefined') {
                      profitMargin = "0";
                  }

                  DAsaveDealer(selectedDealerName, dealerName, profitMargin, markup, useProfit, carpetonly, cushion, useCushion, installation, useInstallation, freight, useFreight, other, useOther, isRetailYd);

              }



              function onCancelDealerClick() {
                  var dealerName = $("#inputDealerSelection").val();
                  setDealerData(dealerName);
                  hideButtons();

              }

              function onDeleteDealerClick() {
                  var selectedDealerName = $("#selectDealerSelection").val();
                  var dealerName = $("#inputDealerSelection").val();
                  var profitMargin = $("#inputProfitMargin").val();
                  var carpetonly = $("#radioCarpetOnly").is(':checked').toString();
                  var markup = $("#inputMarkup").val();
                  var useProfit = $("#radioProfitMargin").is(':checked').toString();
                  var cushion = $("#inputCushion").val();
                  var useCushion = $("#checkboxCushion").is(':checked').toString();
                  var installation = $("#inputInstallation").val();;
                  var useInstallation = $("#checkboxInstallation").is(':checked').toString();
                  var freight = $("#inputFreight").val();
                  var useFreight = $("#checkboxFreight").is(':checked').toString();;;
                  var other = $("#inputOther").val();
                  var useOther = $("#checkboxOther").is(':checked').toString();;
                  var isRetailYd = $("#radioYdFt1").is(':checked').toString();

                  deleteDealer(dealerName, profitMargin, markup, useProfit, carpetonly, cushion, useCushion, installation, useInstallation, freight, useFreight, other, useOther, isRetailYd);
                  clearAll();

                  setDealerData(dealerName);
                  hideButtons();
              }





              function hideButtons() {
                  //  $('#inputDealerSelection').removeClass("ui-hidden-accessible");
                  //$("#inputBtnAdd").attr('hidden', 'hidden');
                  //$("#inputBtnSave").attr('hidden', 'hidden');
                  //$("#inputBtnCancel").attr('hidden', 'hidden');
                  //$("#inputBtnDelete").attr('hidden', 'hidden');
                  //$("#selectDealerSelection").prop('hidden', false);//Chrome
                  //$("#selectDealerSelection").attr('hidden', 'hidden'); //IE on <select> tag
                  //$("#selectDealerSelection").removeAttr('hidden');
                  //$("#inputDealerSelection").attr('hidden', 'hidden');

              }

              function toBool(str) {
                  return str.toLowerCase() == "true";
              }

              function setChecked(elmentName, trueFalseString) {
                  if (toBool(trueFalseString)) {
                      $("#" + elmentName).prop('checked', true).checkboxradio("refresh");
                  }
                  else {
                      $("#" + elmentName).prop('checked', false).checkboxradio("refresh");
                  }
              }

              function setCheckedAttr(elmentName, trueFalseString) {
                  if (toBool(trueFalseString)) {
                      $("#" + elmentName).attr('checked', 'checked');

                      $("#" + elmentName).checkboxradio("refresh");

                  }
                  else {
                      $("#" + elmentName).removeAttr('checked');
                      $("#" + elmentName).checkboxradio("refresh");

                  }
              }

              function setDisabledByCheckBox(elementName, stringCheckBoxValue) {
                  if (toBool(stringCheckBoxValue) == true) {
                      setDisabled(elementName, 'false');
                  }
                  else {
                      setDisabled(elementName, 'true');
                  }
              }

              function setDisabled(elmentName, trueFalseString) {
                  if (toBool(trueFalseString)) {
                      $("#" + elmentName).prop('disabled', true);;
                  }
                  else {
                      $("#" + elmentName).prop('disabled', false);
                  }
              }

              function setDisabledAttr(elmentName, trueFalseString) {
                  if (toBool(trueFalseString)) {
                      $("#" + elmentName).attr('disabled', 'disabled');;
                  }
                  else {
                      $("#" + elmentName).removeAttr('disabled');
                  }
              }

          </script>
	</body>
</html>

